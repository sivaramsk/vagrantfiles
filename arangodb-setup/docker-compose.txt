version: '3.7'

services:
  agency:
    image: arangodb/enterprise:${VERSION:-3.7.12}
    container_name: arango-agency
    restart: unless-stopped
    environment: &AUTH
      ARANGO_NO_AUTH: 1
      #ARANGO_ROOT_PASSWORD: ""
      ARANGO_LICENSE_KEY: ${LICENSE:-"EVALUATION:"} 
    volumes:
      - ./secrets:/etc/secrets
      - agencydata:/var/lib/arangodb3
      - agencyapps:/var/lib/arangodb3-apps
    command: "arangod --server.authentication false --server.endpoint tcp://0.0.0.0:8531 --server.jwt-secret-folder /etc/secrets --agency.activate --agency.my-address tcp://agency:8531 --agency.size 1 --agency.supervision true"
  coordinator1:
    image: arangodb/enterprise:${VERSION:-3.7.12}
    container_name: arango-coordinator-1
    restart: unless-stopped
    environment: *AUTH
    ports:
      - 8529:8529
    volumes:
      - ./secrets:/etc/secrets
      - coordinator1data:/var/lib/arangodb3
      - coordinator1apps:/var/lib/arangodb3-apps
    command: "arangod --server.authentication false --server.endpoint tcp://0.0.0.0:8529 --server.jwt-secret-folder /etc/secrets --cluster.my-address tcp://coordinator1:8529 --cluster.my-role COORDINATOR --cluster.agency-endpoint tcp://agency:8531"
  coordinator2:
    image: arangodb/enterprise:${VERSION:-3.7.12}
    container_name: arango-coordinator-2
    restart: unless-stopped
    environment: *AUTH
    ports:
      - 8539:8539
    volumes:
      - ./secrets:/etc/secrets
      - coordinator2data:/var/lib/arangodb3
      - coordinator2apps:/var/lib/arangodb3-apps
    command: "arangod --server.authentication false --server.endpoint tcp://0.0.0.0:8539 --server.jwt-secret-folder /etc/secrets --cluster.my-address tcp://coordinator2:8539 --cluster.my-role COORDINATOR --cluster.agency-endpoint tcp://agency:8531"
  db1:
    image: arangodb/enterprise:${VERSION:-3.7.12}
    container_name: arango-db-1
    restart: unless-stopped
    environment: *AUTH
    volumes:
      - ./secrets:/etc/secrets
      - db1data:/var/lib/arangodb3
      - db1apps:/var/lib/arangodb3-apps
    command: "arangod --server.authentication false --server.endpoint tcp://0.0.0.0:8530 --server.jwt-secret-folder /etc/secrets --cluster.my-address tcp://db1:8530 --cluster.my-role DBSERVER --cluster.agency-endpoint tcp://agency:8531"
    
  db2:
    image: arangodb/enterprise:${VERSION:-3.7.12}
    container_name: arango-db-2
    restart: unless-stopped
    environment: *AUTH
    volumes:
      - ./secrets:/etc/secrets
      - db2data:/var/lib/arangodb3
      - db2apps:/var/lib/arangodb3-apps
    command: "arangod --server.authentication false --server.endpoint tcp://0.0.0.0:8540 --server.jwt-secret-folder /etc/secrets --cluster.my-address tcp://db2:8540 --cluster.my-role DBSERVER --cluster.agency-endpoint tcp://agency:8531"
    
  db3:
    image: arangodb/enterprise:${VERSION:-3.7.12}
    container_name: arango-db-3
    restart: unless-stopped
    environment: *AUTH
    volumes:
      - ./secrets:/etc/secrets
      - db3data:/var/lib/arangodb3
      - db3apps:/var/lib/arangodb3-apps
    command: "arangod --server.authentication false --server.endpoint tcp://0.0.0.0:8550 --server.jwt-secret-folder /etc/secrets --cluster.my-address tcp://db3:8550 --cluster.my-role DBSERVER --cluster.agency-endpoint tcp://agency:8531"
  minio:
    image: minio/minio:latest
    container_name: minio
    restart: unless-stopped
    volumes:
      - minio:/data
    ports:
      - 9000:9000
      - 9001:9001
    environment:
      MINIO_ROOT_USER: minio
      MINIO_ROOT_PASSWORD: minio123
    command: server --console-address ":9001" /data

volumes:
  agencydata:
  agencyapps:
  coordinator1data:
  coordinator1apps:
  coordinator2data:
  coordinator2apps:
  db1data:
  db1apps:
  db2data:
  db2apps:
  db3data:
  db3apps:
  minio:

    

